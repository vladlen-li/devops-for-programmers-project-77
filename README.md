### Hexlet tests and linter status:
[![Actions Status](https://github.com/vladlen-li/devops-for-programmers-project-77/actions/workflows/hexlet-check.yml/badge.svg)](https://github.com/vladlen-li/devops-for-programmers-project-77/actions)

# üß∞ Infrastructure & Monitoring Automation

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

    Terraform ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (Google Cloud, Datadog)

    Ansible ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Datadog Agent

    Datadog ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç (http_check) –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ Synthetic –ø—Ä–æ–≤–µ—Ä–∫–∏

    dnsmasq ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ –¥–æ–º–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ Terraform-–∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø–æ –∞–ª–∏–∞—Å–∞–º

    Upmon ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤

    Ansible Vault ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–ª—é—á–µ–π, —Ç–æ–∫–µ–Ω–æ–≤)

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç         | –í–µ—Ä—Å–∏—è –∏–ª–∏ –ø–∞–∫–µ—Ç                     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                               |
| ----------------- | ------------------------------------ | ----------- | ---------------------------------------- |
| `Terraform`       | ‚â• 1.5.0                              | ‚úÖ –î–∞        | –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (GCP, Datadog)            |
| `Ansible`         | ‚â• 2.10                               | ‚úÖ –î–∞        | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è VM –∏ Datadog Agent          |
| `python3` + `pip` | —Å `passlib`, `PyYAML` –∏ –¥—Ä           | ‚úÖ –î–∞        | –î–ª—è Ansible –∏ Vault                      |
| `dnsmasq`         | `dnsmasq` –ø–∞–∫–µ—Ç                      | üîÅ –ù–µ—Ç      | (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –õ–æ–∫–∞–ª—å–Ω—ã–µ DNS-–∞–ª–∏–∞—Å—ã –∫ VM  |


## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ `.env` —Ñ–∞–π–ª

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```dotenv
DATABASE_NAME=name
DATABASE_HOST=127.0.0.1
DATABASE_PORT=1234
REDMINE_EXTERNAL_PORT=80
```

2. –ü–æ–¥–≥–æ—Ç–æ–≤—Ç–µ —Ñ–∞–π–ª —Å –∫–ª—é—á–æ–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è ansible-vault
–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `get_vault_key`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

```bash
#!/bin/bash
echo "here_is_your_key"
```

3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
make ansible-dependencies
```

4. üèóÔ∏è –°–æ–∑–¥–∞–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (GCP, Datadog, VM, Load Balancer)

```bash
make build-infra
```
5. üß∞ –ù–∞—Å—Ç—Ä–æ–π —É–¥–∞–ª—ë–Ω–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏ –∑–∞–¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
make deploy
```

‚öôÔ∏è –¢–∞–∫–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ DNS-–∑–∞–ø–∏—Å–∏, –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω dnsmasq

## üìå –ö–æ–º–∞–Ω–¥—ã Makefile

| –¶–µ–ª—å                          | –û–ø–∏—Å–∞–Ω–∏–µ                                |
| ----------------------------- | --------------------------------------- |
| `make build-infra`            | –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –æ–±–Ω–æ–≤–∏—Ç—å DNS   |
| `make deploy`                 | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Datadog Agent, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å VM  |
| `make destroy`                | –£–¥–∞–ª–∏—Ç—å Ansible-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏            |
| `make destroy-terraform`      | –£–¥–∞–ª–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É                  |
| `make update-vms-dns-records` | –û–±–Ω–æ–≤–∏—Ç—å dnsmasq –ø–æ output‚Äô–∞–º Terraform |
| `make edit-secrets`           | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ  |
